import { isAbsolute, resolve } from 'path';
import { GenerateApiCodeFormat, GenerateApiCodeModelTarget, GenerateApiCodeStatementTarget, GenerateApiCodeTypeTarget, } from '@aws-amplify/model-generator';
const DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET = {
    [GenerateApiCodeStatementTarget.JAVASCRIPT]: undefined,
    [GenerateApiCodeStatementTarget.TYPESCRIPT]: GenerateApiCodeTypeTarget.TYPESCRIPT,
    [GenerateApiCodeStatementTarget.GRAPHQL]: undefined,
    [GenerateApiCodeStatementTarget.FLOW]: GenerateApiCodeTypeTarget.FLOW,
    [GenerateApiCodeStatementTarget.ANGULAR]: GenerateApiCodeTypeTarget.ANGULAR,
};
/**
 * Command that generates client config.
 */
export class GenerateGraphqlClientCodeCommand {
    generateApiCodeAdapter;
    backendIdentifierResolver;
    /**
     * @inheritDoc
     */
    command;
    /**
     * @inheritDoc
     */
    describe;
    /**
     * Creates graphql client code generation command.
     */
    constructor(generateApiCodeAdapter, backendIdentifierResolver) {
        this.generateApiCodeAdapter = generateApiCodeAdapter;
        this.backendIdentifierResolver = backendIdentifierResolver;
        this.command = 'graphql-client-code';
        this.describe = 'Generates graphql API code';
    }
    /**
     * @inheritDoc
     */
    handler = async (args) => {
        const backendIdentifier = await this.backendIdentifierResolver.resolve(args);
        const out = this.getOutDir(args);
        const format = args.format ?? GenerateApiCodeFormat.GRAPHQL_CODEGEN;
        const formatParams = this.formatParamBuilders[format](args);
        const result = await this.generateApiCodeAdapter.invokeGenerateApiCode({
            ...backendIdentifier,
            ...formatParams,
        });
        await result.writeToDirectory(out);
    };
    /**
     * @inheritDoc
     */
    builder = (yargs) => {
        return yargs
            .option('stack', {
            conflicts: ['app-id', 'branch'],
            describe: 'A stack name that contains an Amplify backend',
            type: 'string',
            array: false,
            group: 'Stack identifier',
        })
            .option('app-id', {
            conflicts: ['stack'],
            describe: 'The Amplify App ID of the project',
            type: 'string',
            array: false,
            implies: 'branch',
            group: 'Project identifier',
        })
            .option('branch', {
            conflicts: ['stack'],
            describe: 'A git branch of the Amplify project',
            type: 'string',
            array: false,
            group: 'Project identifier',
        })
            .option('out', {
            describe: 'A path to directory where config is written. If not provided defaults to current process working directory.',
            type: 'string',
            array: false,
        })
            .option('format', {
            describe: 'The format that the GraphQL client code should be generated in.',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeFormat),
        })
            .option('model-target', {
            describe: 'The modelgen export target. Only applies when the `--format` parameter is set to `modelgen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeModelTarget),
        })
            .option('statement-target', {
            describe: 'The graphql-codegen statement export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeStatementTarget),
        })
            .option('type-target', {
            describe: 'The optional graphql-codegen type export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeTypeTarget),
        })
            .option('model-generate-index-rules', {
            description: 'Adds key/index details to iOS models',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-emit-auth-provider', {
            description: 'Adds auth provider details to iOS models',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-respect-primary-key-attributes-on-connection-field', {
            description: 'If enabled, Datastore queries will respect the primary + sort key fields, rather than a default id field',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-generate-models-for-lazy-load-and-custom-selection-set', {
            description: 'Generates lazy model type definitions, required or amplify-js v5+',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-add-timestamp-fields', {
            description: 'Add read-only timestamp fields in modelgen.',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-handle-list-nullability-transparently', {
            description: 'Configure the nullability of the List and List components in Datastore Models generation',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('statement-max-depth', {
            description: 'Determines how deeply nested to generate graphql statements.',
            type: 'number',
            array: false,
            hidden: true,
        })
            .option('statement-typename-introspection', {
            description: 'Determines whether to include default __typename for all generated statements',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('type-multiple-swift-files', {
            description: 'Determines whether or not to generate a single API.swift, or multiple per-model swift files.',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .showHidden('all');
    };
    /**
     * Produce the required input for graphql-codegen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the codegen options config
     */
    getGraphqlCodegenFormatParams = (args) => {
        const statementTarget = args['statement-target'] ?? GenerateApiCodeStatementTarget.TYPESCRIPT;
        const typeTarget = args['type-target'] ??
            DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET[statementTarget];
        const maxDepth = args['statement-max-depth'];
        const typeNameIntrospection = args['statement-typename-introspection'];
        const multipleSwiftFiles = args['type-multiple-swift-files'];
        return {
            format: GenerateApiCodeFormat.GRAPHQL_CODEGEN,
            statementTarget,
            ...(typeTarget !== undefined ? { typeTarget } : {}),
            ...(maxDepth !== undefined ? { maxDepth } : {}),
            ...(typeNameIntrospection !== undefined ? { typeNameIntrospection } : {}),
            ...(multipleSwiftFiles !== undefined ? { multipleSwiftFiles } : {}),
        };
    };
    /**
     * Produce the required input for modelgen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the modelgen options config
     */
    getModelgenFormatParams = (args) => {
        const modelTarget = args['model-target'] ?? GenerateApiCodeModelTarget.TYPESCRIPT;
        const generateIndexRules = args['model-generate-index-rules'];
        const emitAuthProvider = args['model-emit-auth-provider'];
        const respectPrimaryKeyAttributesOnConnectionField = args['model-respect-primary-key-attributes-on-connection-field'];
        const generateModelsForLazyLoadAndCustomSelectionSet = args['model-generate-models-for-lazy-load-and-custom-selection-set'];
        const addTimestampFields = args['model-add-timestamp-fields'];
        const handleListNullabilityTransparently = args['model-handle-list-nullability-transparently'];
        return {
            format: GenerateApiCodeFormat.MODELGEN,
            modelTarget,
            ...(generateIndexRules !== undefined ? { generateIndexRules } : {}),
            ...(emitAuthProvider !== undefined ? { emitAuthProvider } : {}),
            ...(respectPrimaryKeyAttributesOnConnectionField !== undefined
                ? { respectPrimaryKeyAttributesOnConnectionField }
                : {}),
            ...(generateModelsForLazyLoadAndCustomSelectionSet !== undefined
                ? { generateModelsForLazyLoadAndCustomSelectionSet }
                : {}),
            ...(addTimestampFields !== undefined ? { addTimestampFields } : {}),
            ...(handleListNullabilityTransparently !== undefined
                ? { handleListNullabilityTransparently }
                : {}),
        };
    };
    /**
     * Produce the introspection schema config shape.
     * @returns the introspection options config
     */
    getIntrospectionFormatParams = () => ({
        format: GenerateApiCodeFormat.INTROSPECTION,
    });
    getOutDir = (args) => {
        const cwd = process.cwd();
        if (!args.out) {
            return cwd;
        }
        return isAbsolute(args.out) ? args.out : resolve(cwd, args.out);
    };
    // This property references other methods in the class so it must be defined at the end.
    // This is probably an indicator that some refactoring should happen here but right now I'm just trying to apply this lint rule to the codebase
    // eslint-disable-next-line @typescript-eslint/member-ordering
    formatParamBuilders = {
        [GenerateApiCodeFormat.MODELGEN]: this.getModelgenFormatParams,
        [GenerateApiCodeFormat.GRAPHQL_CODEGEN]: this.getGraphqlCodegenFormatParams,
        [GenerateApiCodeFormat.INTROSPECTION]: this.getIntrospectionFormatParams,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1hbmRzL2dlbmVyYXRlL2dyYXBocWwtY2xpZW50LWNvZGUvZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBSzNDLE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsMEJBQTBCLEVBQzFCLDhCQUE4QixFQUM5Qix5QkFBeUIsR0FJMUIsTUFBTSw4QkFBOEIsQ0FBQztBQStCdEMsTUFBTSx3Q0FBd0MsR0FHMUM7SUFDRixDQUFDLDhCQUE4QixDQUFDLFVBQVUsQ0FBQyxFQUFFLFNBQVM7SUFDdEQsQ0FBQyw4QkFBOEIsQ0FBQyxVQUFVLENBQUMsRUFDekMseUJBQXlCLENBQUMsVUFBVTtJQUN0QyxDQUFDLDhCQUE4QixDQUFDLE9BQU8sQ0FBQyxFQUFFLFNBQVM7SUFDbkQsQ0FBQyw4QkFBOEIsQ0FBQyxJQUFJLENBQUMsRUFBRSx5QkFBeUIsQ0FBQyxJQUFJO0lBQ3JFLENBQUMsOEJBQThCLENBQUMsT0FBTyxDQUFDLEVBQUUseUJBQXlCLENBQUMsT0FBTztDQUM1RSxDQUFDO0FBRUY7O0dBRUc7QUFDSCxNQUFNLE9BQU8sZ0NBQWdDO0lBaUJ4QjtJQUNBO0lBZm5COztPQUVHO0lBQ00sT0FBTyxDQUFTO0lBRXpCOztPQUVHO0lBQ00sUUFBUSxDQUFTO0lBRTFCOztPQUVHO0lBQ0gsWUFDbUIsc0JBQThDLEVBQzlDLHlCQUFvRDtRQURwRCwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFFckUsSUFBSSxDQUFDLE9BQU8sR0FBRyxxQkFBcUIsQ0FBQztRQUNyQyxJQUFJLENBQUMsUUFBUSxHQUFH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IH0gZnJvbSAneWFyZ3MnO1xuaW1wb3J0IHsgQmFja2VuZElkZW50aWZpZXJSZXNvbHZlciB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQtaWRlbnRpZmllci9iYWNrZW5kX2lkZW50aWZpZXJfcmVzb2x2ZXIuanMnO1xuaW1wb3J0IHsgaXNBYnNvbHV0ZSwgcmVzb2x2ZSB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHtcbiAgR2VuZXJhdGVBcGlDb2RlQWRhcHRlcixcbiAgSW52b2tlR2VuZXJhdGVBcGlDb2RlUHJvcHMsXG59IGZyb20gJy4vZ2VuZXJhdGVfYXBpX2NvZGVfYWRhcHRlci5qcyc7XG5pbXBvcnQge1xuICBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQsXG4gIEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0LFxuICBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQsXG4gIEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQsXG4gIEdlbmVyYXRlR3JhcGhxbENvZGVnZW5PcHRpb25zLFxuICBHZW5lcmF0ZUludHJvc3BlY3Rpb25PcHRpb25zLFxuICBHZW5lcmF0ZU1vZGVsc09wdGlvbnMsXG59IGZyb20gJ0Bhd3MtYW1wbGlmeS9tb2RlbC1nZW5lcmF0b3InO1xuaW1wb3J0IHsgQXJndW1lbnRzS2ViYWJDYXNlIH0gZnJvbSAnLi4vLi4vLi4va2ViYWJfY2FzZS5qcyc7XG5cbnR5cGUgR2VuZXJhdGVPcHRpb25zID1cbiAgfCBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9uc1xuICB8IEdlbmVyYXRlTW9kZWxzT3B0aW9uc1xuICB8IEdlbmVyYXRlSW50cm9zcGVjdGlvbk9wdGlvbnM7XG5cbmV4cG9ydCB0eXBlIEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9ucyA9XG4gIEFyZ3VtZW50c0tlYmFiQ2FzZTxHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnNDYW1lbENhc2U+O1xuXG50eXBlIEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9uc0NhbWVsQ2FzZSA9IHtcbiAgc3RhY2s6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgYXBwSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgYnJhbmNoOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGZvcm1hdDogR2VuZXJhdGVBcGlDb2RlRm9ybWF0IHwgdW5kZWZpbmVkO1xuICBtb2RlbFRhcmdldDogR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQgfCB1bmRlZmluZWQ7XG4gIHN0YXRlbWVudFRhcmdldDogR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0IHwgdW5kZWZpbmVkO1xuICB0eXBlVGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0IHwgdW5kZWZpbmVkO1xuICBvdXQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgbW9kZWxHZW5lcmF0ZUluZGV4UnVsZXM6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIG1vZGVsRW1pdEF1dGhQcm92aWRlcjogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxSZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZDogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxHZW5lcmF0ZU1vZGVsc0ZvckxhenlMb2FkQW5kQ3VzdG9tU2VsZWN0aW9uU2V0OiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBtb2RlbEFkZFRpbWVzdGFtcEZpZWxkczogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxIYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5OiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBzdGF0ZW1lbnRNYXhEZXB0aDogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICBzdGF0ZW1lbnRUeXBlbmFtZUludHJvc3BlY3Rpb246IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIHR5cGVNdWx0aXBsZVN3aWZ0RmlsZXM6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG59O1xuXG5jb25zdCBERUZBVUxUX1RZUEVfVEFSR0VUX0ZPUl9TVEFURU1FTlRfVEFSR0VUOiBSZWNvcmQ8XG4gIEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldCxcbiAgR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldCB8IHVuZGVmaW5lZFxuPiA9IHtcbiAgW0dlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5KQVZBU0NSSVBUXTogdW5kZWZpbmVkLFxuICBbR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LlRZUEVTQ1JJUFRdOlxuICAgIEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQuVFlQRVNDUklQVCxcbiAgW0dlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5HUkFQSFFMXTogdW5kZWZpbmVkLFxuICBbR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LkZMT1ddOiBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0LkZMT1csXG4gIFtHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuQU5HVUxBUl06IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQuQU5HVUxBUixcbn07XG5cbi8qKlxuICogQ29tbWFuZCB0aGF0IGdlbmVyYXRlcyBjbGllbnQgY29uZmlnLlxuICovXG5leHBvcnQgY2xhc3MgR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRcbiAgaW1wbGVtZW50cyBDb21tYW5kTW9kdWxlPG9iamVjdCwgR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zPlxue1xuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHJlYWRvbmx5IGNvbW1hbmQ6IHN0cmluZztcblxuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaWJlOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgZ3JhcGhxbCBjbGllbnQgY29kZSBnZW5lcmF0aW9uIGNvbW1hbmQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdlbmVyYXRlQXBpQ29kZUFkYXB0ZXI6IEdlbmVyYXRlQXBpQ29kZUFkYXB0ZXIsXG4gICAgcHJpdmF0ZSByZWFkb25seSBiYWNrZW5kSWRlbnRpZmllclJlc29sdmVyOiBCYWNrZW5kSWRlbnRpZmllclJlc29sdmVyXG4gICkge1xuICAgIHRoaXMuY29tbWFuZCA9ICdncmFwaHFsLWNsaWVudC1jb2RlJztcbiAgICB0aGlzLmRlc2NyaWJlID0gJ0dlbmVyYXRlcyBncmFwaHFsIEFQSSBjb2RlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdERvY1xuICAgKi9cbiAgaGFuZGxlciA9IGFzeW5jIChcbiAgICBhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnNcbiAgKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgY29uc3QgYmFja2VuZElkZW50aWZpZXIgPSBhd2FpdCB0aGlzLmJhY2tlbmRJZGVudGlmaWVyUmVzb2x2ZXIucmVzb2x2ZShcbiAgICAgIGFyZ3NcbiAgICApO1xuICAgIGNvbnN0IG91dCA9IHRoaXMuZ2V0T3V0RGlyKGFyZ3MpO1xuICAgIGNvbnN0IGZvcm1hdCA9IGFyZ3MuZm9ybWF0ID8/IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5HUkFQSFFMX0NPREVHRU47XG4gICAgY29uc3QgZm9ybWF0UGFyYW1zID0gdGhpcy5mb3JtYXRQYXJhbUJ1aWxkZXJzW2Zvcm1hdF0oYXJncyk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmdlbmVyYXRlQXBpQ29kZUFkYXB0ZXIuaW52b2tlR2VuZXJhdGVBcGlDb2RlKHtcbiAgICAgIC4uLmJhY2tlbmRJZGVudGlmaWVyLFxuICAgICAgLi4uZm9ybWF0UGFyYW1zLFxuICAgIH0gYXMgdW5rbm93biBhcyBJbnZva2VHZW5lcmF0ZUFwaUNvZGVQcm9wcyk7XG5cbiAgICBhd2FpdCByZXN1bHQud3JpdGVUb0RpcmVjdG9yeShvdXQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAaW5oZXJpdERvY1xuICAgKi9cbiAgYnVpbGRlciA9ICh5YXJnczogQXJndik6IEFyZ3Y8R2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zPiA9PiB7XG4gICAgcmV0dXJuIHlhcmdzXG4gICAgICAub3B0aW9uKCdzdGFjaycsIHtcbiAgICAgICAgY29uZmxpY3RzOiBbJ2FwcC1pZCcsICdicmFuY2gnXSxcbiAgICAgICAgZGVzY3JpYmU6ICdBIHN0YWNrIG5hbWUgdGhhdCBjb250YWlucyBhbiBBbXBsaWZ5IGJhY2tlbmQnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBncm91cDogJ1N0YWNrIGlkZW50aWZpZXInLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ2FwcC1pZCcsIHtcbiAgICAgICAgY29uZmxpY3RzOiBbJ3N0YWNrJ10sXG4gICAgICAgIGRlc2NyaWJlOiAnVGhlIEFtcGxpZnkgQXBwIElEIG9mIHRoZSBwcm9qZWN0JyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaW1wbGllczogJ2JyYW5jaCcsXG4gICAgICAgIGdyb3VwOiAnUHJvamVjdCBpZGVudGlmaWVyJyxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdicmFuY2gnLCB7XG4gICAgICAgIGNvbmZsaWN0czogWydzdGFjayddLFxuICAgICAgICBkZXNjcmliZTogJ0EgZ2l0IGJyYW5jaCBvZiB0aGUgQW1wbGlmeSBwcm9qZWN0JyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgZ3JvdXA6ICdQcm9qZWN0IGlkZW50aWZpZXInLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ291dCcsIHtcbiAgICAgICAgZGVzY3JpYmU6XG4gICAgICAgICAgJ0EgcGF0aCB0byBkaXJlY3Rvcnkgd2hlcmUgY29uZmlnIGlzIHdyaXR0ZW4uIElmIG5vdCBwcm92aWRlZCBkZWZhdWx0cyB0byBjdXJyZW50IHByb2Nlc3Mgd29ya2luZyBkaXJlY3RvcnkuJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdmb3JtYXQnLCB7XG4gICAgICAgIGRlc2NyaWJlOlxuICAgICAgICAgICdUaGUgZm9ybWF0IHRoYXQgdGhlIEdyYXBoUUwgY2xpZW50IGNvZGUgc2hvdWxkIGJlIGdlbmVyYXRlZCBpbi4nLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBjaG9pY2VzOiBPYmplY3QudmFsdWVzKEdlbmVyYXRlQXBpQ29kZUZvcm1hdCksXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtdGFyZ2V0Jywge1xuICAgICAgICBkZXNjcmliZTpcbiAgICAgICAgICAnVGhlIG1vZGVsZ2VuIGV4cG9ydCB0YXJnZXQuIE9ubHkgYXBwbGllcyB3aGVuIHRoZSBgLS1mb3JtYXRgIHBhcmFtZXRlciBpcyBzZXQgdG8gYG1vZGVsZ2VuYCcsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGNob2ljZXM6IE9iamVjdC52YWx1ZXMoR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQpLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ3N0YXRlbWVudC10YXJnZXQnLCB7XG4gICAgICAgIGRlc2NyaWJlOlxuICAgICAgICAgICdUaGUgZ3JhcGhxbC1jb2RlZ2VuIHN0YXRlbWVudCBleHBvcnQgdGFyZ2V0LiBPbmx5IGFwcGxpZXMgd2hlbiB0aGUgYC0tZm9ybWF0YCBwYXJhbWV0ZXIgaXMgc2V0IHRvIGBncmFwaHFsLWNvZGVnZW5gJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgY2hvaWNlczogT2JqZWN0LnZhbHVlcyhHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQpLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ3R5cGUtdGFyZ2V0Jywge1xuICAgICAgICBkZXNjcmliZTpcbiAgICAgICAgICAnVGhlIG9wdGlvbmFsIGdyYXBocWwtY29kZWdlbiB0eXBlIGV4cG9ydCB0YXJnZXQuIE9ubHkgYXBwbGllcyB3aGVuIHRoZSBgLS1mb3JtYXRgIHBhcmFtZXRlciBpcyBzZXQgdG8gYGdyYXBocWwtY29kZWdlbmAnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBjaG9pY2VzOiBPYmplY3QudmFsdWVzKEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQpLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLWdlbmVyYXRlLWluZGV4LXJ1bGVzJywge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ0FkZHMga2V5L2luZGV4IGRldGFpbHMgdG8gaU9TIG1vZGVscycsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtZW1pdC1hdXRoLXByb3ZpZGVyJywge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ0FkZHMgYXV0aCBwcm92aWRlciBkZXRhaWxzIHRvIGlPUyBtb2RlbHMnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLXJlc3BlY3QtcHJpbWFyeS1rZXktYXR0cmlidXRlcy1vbi1jb25uZWN0aW9uLWZpZWxkJywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnSWYgZW5hYmxlZCwgRGF0YXN0b3JlIHF1ZXJpZXMgd2lsbCByZXNwZWN0IHRoZSBwcmltYXJ5ICsgc29ydCBrZXkgZmllbGRzLCByYXRoZXIgdGhhbiBhIGRlZmF1bHQgaWQgZmllbGQnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLWdlbmVyYXRlLW1vZGVscy1mb3ItbGF6eS1sb2FkLWFuZC1jdXN0b20tc2VsZWN0aW9uLXNldCcsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0dlbmVyYXRlcyBsYXp5IG1vZGVsIHR5cGUgZGVmaW5pdGlvbnMsIHJlcXVpcmVkIG9yIGFtcGxpZnktanMgdjUrJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1hZGQtdGltZXN0YW1wLWZpZWxkcycsIHtcbiAgICAgICAgZGVzY3JpcHRpb246ICdBZGQgcmVhZC1vbmx5IHRpbWVzdGFtcCBmaWVsZHMgaW4gbW9kZWxnZW4uJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1oYW5kbGUtbGlzdC1udWxsYWJpbGl0eS10cmFuc3BhcmVudGx5Jywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnQ29uZmlndXJlIHRoZSBudWxsYWJpbGl0eSBvZiB0aGUgTGlzdCBhbmQgTGlzdCBjb21wb25lbnRzIGluIERhdGFzdG9yZSBNb2RlbHMgZ2VuZXJhdGlvbicsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignc3RhdGVtZW50LW1heC1kZXB0aCcsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0RldGVybWluZXMgaG93IGRlZXBseSBuZXN0ZWQgdG8gZ2VuZXJhdGUgZ3JhcGhxbCBzdGF0ZW1lbnRzLicsXG4gICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdzdGF0ZW1lbnQtdHlwZW5hbWUtaW50cm9zcGVjdGlvbicsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0RldGVybWluZXMgd2hldGhlciB0byBpbmNsdWRlIGRlZmF1bHQgX190eXBlbmFtZSBmb3IgYWxsIGdlbmVyYXRlZCBzdGF0ZW1lbnRzJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCd0eXBlLW11bHRpcGxlLXN3aWZ0LWZpbGVzJywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnRGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBnZW5lcmF0ZSBhIHNpbmdsZSBBUEkuc3dpZnQsIG9yIG11bHRpcGxlIHBlci1tb2RlbCBzd2lmdCBmaWxlcy4nLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5zaG93SGlkZGVuKCdhbGwnKTtcbiAgfTtcblxuICAvKipcbiAgICogUHJvZHVjZSB0aGUgcmVxdWlyZWQgaW5wdXQgZm9yIGdyYXBocWwtY29kZWdlbiBjYWxscyBmcm9tIHRoZSBDTEkgaW5wdXQsIGFwcGx5aW5nIHNhbmUgZGVmYXVsdHMgd2hlcmUgYXBwbGljYWJsZS5cbiAgICogQHBhcmFtIGFyZ3MgQ0xJIGFyZ3MgcHJvdmlkZWQgYnkgdGhlIGN1c3RvbWVyXG4gICAqIEByZXR1cm5zIHRoZSBjb2RlZ2VuIG9wdGlvbnMgY29uZmlnXG4gICAqL1xuICBwcml2YXRlIGdldEdyYXBocWxDb2RlZ2VuRm9ybWF0UGFyYW1zID0gKFxuICAgIGFyZ3M6IEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9uc1xuICApOiBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9ucyA9PiB7XG4gICAgY29uc3Qgc3RhdGVtZW50VGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQgPVxuICAgICAgYXJnc1snc3RhdGVtZW50LXRhcmdldCddID8/IEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5UWVBFU0NSSVBUO1xuICAgIGNvbnN0IHR5cGVUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQgfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1sndHlwZS10YXJnZXQnXSA/P1xuICAgICAgREVGQVVMVF9UWVBFX1RBUkdFVF9GT1JfU1RBVEVNRU5UX1RBUkdFVFtzdGF0ZW1lbnRUYXJnZXRdO1xuICAgIGNvbnN0IG1heERlcHRoOiBudW1iZXIgfCB1bmRlZmluZWQgPSBhcmdzWydzdGF0ZW1lbnQtbWF4LWRlcHRoJ107XG4gICAgY29uc3QgdHlwZU5hbWVJbnRyb3NwZWN0aW9uOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ3N0YXRlbWVudC10eXBlbmFtZS1pbnRyb3NwZWN0aW9uJ107XG4gICAgY29uc3QgbXVsdGlwbGVTd2lmdEZpbGVzOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ3R5cGUtbXVsdGlwbGUtc3dpZnQtZmlsZXMnXTtcblxuICAgIHJldHVybiB7XG4gICAgICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5HUkFQSFFMX0NPREVHRU4sXG4gICAgICBzdGF0ZW1lbnRUYXJnZXQsXG4gICAgICAuLi4odHlwZVRhcmdldCAhPT0gdW5kZWZpbmVkID8geyB0eXBlVGFyZ2V0IH0gOiB7fSksXG4gICAgICAuLi4obWF4RGVwdGggIT09IHVuZGVmaW5lZCA/IHsgbWF4RGVwdGggfSA6IHt9KSxcbiAgICAgIC4uLih0eXBlTmFtZUludHJvc3BlY3Rpb24gIT09IHVuZGVmaW5lZCA/IHsgdHlwZU5hbWVJbnRyb3NwZWN0aW9uIH0gOiB7fSksXG4gICAgICAuLi4obXVsdGlwbGVTd2lmdEZpbGVzICE9PSB1bmRlZmluZWQgPyB7IG11bHRpcGxlU3dpZnRGaWxlcyB9IDoge30pLFxuICAgIH07XG4gIH07XG5cbiAgLyoqXG4gICAqIFByb2R1Y2UgdGhlIHJlcXVpcmVkIGlucHV0IGZvciBtb2RlbGdlbiBjYWxscyBmcm9tIHRoZSBDTEkgaW5wdXQsIGFwcGx5aW5nIHNhbmUgZGVmYXVsdHMgd2hlcmUgYXBwbGljYWJsZS5cbiAgICogQHBhcmFtIGFyZ3MgQ0xJIGFyZ3MgcHJvdmlkZWQgYnkgdGhlIGN1c3RvbWVyXG4gICAqIEByZXR1cm5zIHRoZSBtb2RlbGdlbiBvcHRpb25zIGNvbmZpZ1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRNb2RlbGdlbkZvcm1hdFBhcmFtcyA9IChcbiAgICBhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnNcbiAgKTogR2VuZXJhdGVNb2RlbHNPcHRpb25zID0+IHtcbiAgICBjb25zdCBtb2RlbFRhcmdldDogR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQgPVxuICAgICAgYXJnc1snbW9kZWwtdGFyZ2V0J10gPz8gR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQuVFlQRVNDUklQVDtcbiAgICBjb25zdCBnZW5lcmF0ZUluZGV4UnVsZXM6IGJvb2xlYW4gfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1snbW9kZWwtZ2VuZXJhdGUtaW5kZXgtcnVsZXMnXTtcbiAgICBjb25zdCBlbWl0QXV0aFByb3ZpZGVyOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWVtaXQtYXV0aC1wcm92aWRlciddO1xuICAgIGNvbnN0IHJlc3BlY3RQcmltYXJ5S2V5QXR0cmlidXRlc09uQ29ubmVjdGlvbkZpZWxkOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLXJlc3BlY3QtcHJpbWFyeS1rZXktYXR0cmlidXRlcy1vbi1jb25uZWN0aW9uLWZpZWxkJ107XG4gICAgY29uc3QgZ2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldDogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1nZW5lcmF0ZS1tb2RlbHMtZm9yLWxhenktbG9hZC1hbmQtY3VzdG9tLXNlbGVjdGlvbi1zZXQnXTtcbiAgICBjb25zdCBhZGRUaW1lc3RhbXBGaWVsZHM6IGJvb2xlYW4gfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1snbW9kZWwtYWRkLXRpbWVzdGFtcC1maWVsZHMnXTtcbiAgICBjb25zdCBoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5OiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWhhbmRsZS1saXN0LW51bGxhYmlsaXR5LXRyYW5zcGFyZW50bHknXTtcblxuICAgIHJldHVybiB7XG4gICAgICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5NT0RFTEdFTixcbiAgICAgIG1vZGVsVGFyZ2V0LFxuICAgICAgLi4uKGdlbmVyYXRlSW5kZXhSdWxlcyAhPT0gdW5kZWZpbmVkID8geyBnZW5lcmF0ZUluZGV4UnVsZXMgfSA6IHt9KSxcbiAgICAgIC4uLihlbWl0QXV0aFByb3ZpZGVyICE9PSB1bmRlZmluZWQgPyB7IGVtaXRBdXRoUHJvdmlkZXIgfSA6IHt9KSxcbiAgICAgIC4uLihyZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZCAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8geyByZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZCB9XG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQgIT09IHVuZGVmaW5lZFxuICAgICAgICA/IHsgZ2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldCB9XG4gICAgICAgIDoge30pLFxuICAgICAgLi4uKGFkZFRpbWVzdGFtcEZpZWxkcyAhPT0gdW5kZWZpbmVkID8geyBhZGRUaW1lc3RhbXBGaWVsZHMgfSA6IHt9KSxcbiAgICAgIC4uLihoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5ICE9PSB1bmRlZmluZWRcbiAgICAgICAgPyB7IGhhbmRsZUxpc3ROdWxsYWJpbGl0eVRyYW5zcGFyZW50bHkgfVxuICAgICAgICA6IHt9KSxcbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcm9kdWNlIHRoZSBpbnRyb3NwZWN0aW9uIHNjaGVtYSBjb25maWcgc2hhcGUuXG4gICAqIEByZXR1cm5zIHRoZSBpbnRyb3NwZWN0aW9uIG9wdGlvbnMgY29uZmlnXG4gICAqL1xuICBwcml2YXRlIGdldEludHJvc3BlY3Rpb25Gb3JtYXRQYXJhbXMgPSAoKTogR2VuZXJhdGVJbnRyb3NwZWN0aW9uT3B0aW9ucyA9PiAoe1xuICAgIGZvcm1hdDogR2VuZXJhdGVBcGlDb2RlRm9ybWF0LklOVFJPU1BFQ1RJT04sXG4gIH0pO1xuXG4gIHByaXZhdGUgZ2V0T3V0RGlyID0gKGFyZ3M6IEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9ucykgPT4ge1xuICAgIGNvbnN0IGN3ZCA9IHByb2Nlc3MuY3dkKCk7XG4gICAgaWYgKCFhcmdzLm91dCkge1xuICAgICAgcmV0dXJuIGN3ZDtcbiAgICB9XG4gICAgcmV0dXJuIGlzQWJzb2x1dGUoYXJncy5vdXQpID8gYXJncy5vdXQgOiByZXNvbHZlKGN3ZCwgYXJncy5vdXQpO1xuICB9O1xuXG4gIC8vIFRoaXMgcHJvcGVydHkgcmVmZXJlbmNlcyBvdGhlciBtZXRob2RzIGluIHRoZSBjbGFzcyBzbyBpdCBtdXN0IGJlIGRlZmluZWQgYXQgdGhlIGVuZC5cbiAgLy8gVGhpcyBpcyBwcm9iYWJseSBhbiBpbmRpY2F0b3IgdGhhdCBzb21lIHJlZmFjdG9yaW5nIHNob3VsZCBoYXBwZW4gaGVyZSBidXQgcmlnaHQgbm93IEknbSBqdXN0IHRyeWluZyB0byBhcHBseSB0aGlzIGxpbnQgcnVsZSB0byB0aGUgY29kZWJhc2VcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9tZW1iZXItb3JkZXJpbmdcbiAgcHJpdmF0ZSBmb3JtYXRQYXJhbUJ1aWxkZXJzOiBSZWNvcmQ8XG4gICAgR2VuZXJhdGVBcGlDb2RlRm9ybWF0LFxuICAgIChhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnMpID0+IEdlbmVyYXRlT3B0aW9uc1xuICA+ID0ge1xuICAgIFtHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuTU9ERUxHRU5dOiB0aGlzLmdldE1vZGVsZ2VuRm9ybWF0UGFyYW1zLFxuICAgIFtHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuR1JBUEhRTF9DT0RFR0VOXTogdGhpcy5nZXRHcmFwaHFsQ29kZWdlbkZvcm1hdFBhcmFtcyxcbiAgICBbR2VuZXJhdGVBcGlDb2RlRm9ybWF0LklOVFJPU1BFQ1RJT05dOiB0aGlzLmdldEludHJvc3BlY3Rpb25Gb3JtYXRQYXJhbXMsXG4gIH07XG59XG4iXX0=